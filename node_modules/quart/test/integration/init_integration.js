const portscanner = require('portscanner');
const http2 = require('http2');

describe('Initial Setup Test Suite', function () {
  it('should listen on an open port', async () => {
    global.port = await portscanner.findAPortNotInUse(8080, 10080);
    // Port scanner has a confusing mapping for Open and Closed
    expect(await portscanner.checkPortStatus(port)).to.be.equal("closed");
    await new Promise((resolve, reject) => app.listen(port, resolve));
    expect(await portscanner.checkPortStatus(port)).to.be.equal("open");
  });

  it('should start a valid http/2 server', () => {
    const client = http2.connect(`https://localhost:${port}`);
    expect(client.type).to.be.equal(http2.constants.NGHTTP2_SESSION_CLIENT);
    client.destroy();
  });
});