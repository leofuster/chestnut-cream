const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');
const Quart = require('../Quart');

// Allow self generated certs with requests
process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0";

// Require globals
global.libraryPath = path.resolve(__dirname, '../lib/');
global.requireFromLibrary = (file) => require(path.resolve(libraryPath, file));

const cert = fs.readFileSync(path.resolve(__dirname, './certs/all/my-private-root-ca.cert.pem'), 'utf8');
const key = fs.readFileSync(path.resolve(__dirname, './certs/all/my-private-root-ca.privkey.pem'), 'utf8');

// Assign test globals
global.expect = require('chai').expect;
global.app = new Quart({ key, cert });
global.cert = cert;
global.key = key;

// Unit tests
require('./unit/MapList_unit.js');
require('./unit/WeakList_unit.js');
require('./unit/Router_unit.js');
require('./unit/SubStream_unit');
// Integration tests
require('./integration/init_integration.js');
require('./integration/routing_integration.js');
require('./integration/handler_integration.js');
require('./integration/middleware_integration.js');
require('./integration/dynamic_file_integration.js');
require('./integration/return_types_integration.js');
require('./integration/exception_integration.js');
require('./integration/push_integration.js');